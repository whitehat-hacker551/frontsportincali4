<div class="container my-2">
  <div class="d-flex justify-content-center my-3">
    <h1>Comentarios</h1>
  </div>

  <!-- Aviso (mensaje desde queryParams) -->
  @if (message()) {
    <div class="d-flex justify-content-center my-2">
      <div class="alert alert-success w-100 text-center" role="alert">
        {{ message() }}
      </div>
    </div>
  }

  <!-- Búsqueda por contenido usando debounce -->
  <div class="d-flex justify-content-center my-2">
    <input
      class="form-control me-2"
      type="search"      
      placeholder="Buscar por posición del jugador"
      aria-label="Search"
      (input)="onSearch($event.target.value)"
      [value]="contenido()"
      name="searchContenido"
    />
  </div>

  <!-- Total registros -->
  <div class="d-flex justify-content-center my-1">
    <small class="text-muted">Total registros: {{ totalRecords() || 0 }}</small>
    @if (idUsuario() > 0) {
      <small class="text-muted ms-3">Filtro: id de usuario = {{ idUsuario() }}</small>
      <!-- quitar el filtro -->
      <a class="ms-2" [routerLink]="['/comentario']" role="button" title="Quitar filtro"
        ><i class="bi bi-x-lg" aria-hidden="true"></i> Quitar filtro</a
      >
    }
    @if (idNoticia() > 0) {
      <small class="text-muted ms-3">Filtro: id de noticia = {{ idNoticia() }}</small>
      <!-- quitar el filtro -->
      <a class="ms-2" [routerLink]="['/comentario']" role="button" title="Quitar filtro"
        ><i class="bi bi-x-lg" aria-hidden="true"></i> Quitar filtro</a
      >
    }
    @if (contenido().length > 0) {
      <small class="text-muted ms-3">Filtro: Contenido contiene "{{ contenido() }}"</small>
      <!-- quitar el filtro -->
    }
  </div>

  @if(totalRecords() > 0) {
     @if(totalRecords() <= numRpp()) {
      <div class="d-flex justify-content-end my-1">
        <app-botonera-rpp [numRpp]="numRpp()" (rppChange)="onRppChange($event)"> </app-botonera-rpp>
      </div>
     } @else {
       <div class="d-flex justify-content-between my-1">
         <app-paginacion
           [numPage]="numPage()"
           [numPages]="oPage()?.totalPages || 1"
           (pageChange)="goToPage($event)"
         >
         </app-paginacion>
   
         <app-botonera-rpp [numRpp]="numRpp()" (rppChange)="onRppChange($event)"> </app-botonera-rpp>
       </div>
     }
  }

  <div class="d-flex justify-content-center">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th scope="col" (click)="onOrder('id')" style="cursor: pointer; width: 5%">
            <span class="header-inline"
              >ID 
                @if (orderField() === 'id') { 
                  @if (orderDirection() === 'asc') {
                    <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
                } 
                @if (orderDirection() === 'desc') {
                  <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
                } 
              }
            </span>
          </th>
          <th scope="col" (click)="onOrder('contenido')" style="cursor: pointer; width: 35%">
            <span class="header-inline"
              >Contenido 
                @if (orderField() === 'contenido') { 
                  @if (orderDirection() === 'asc') {
                    <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
                } 
                @if (orderDirection() === 'desc') {
                  <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
                } 
              }
            </span>
          </th>
          <th scope="col" (click)="onOrder('usuario')" style="cursor: pointer; width: 30%">
            <span class="header-inline"
              >Usuario 
                @if (orderField() === 'usuario') { 
                  @if (orderDirection() === 'asc') {
                    <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
                } 
                @if (orderDirection() === 'desc') {
                  <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
                } 
              }
            </span>
          </th>
          <th scope="col" (click)="onOrder('noticia')" style="cursor: pointer; width: 30%">
            <span class="header-inline"
              >Noticia 
                @if (orderField() === 'noticia') { 
                  @if (orderDirection() === 'asc') {
                    <i class="bi bi-caret-up-fill ms-1"></i>
                } 
                @if (orderDirection() === 'desc') {
                  <i class="bi bi-caret-down-fill ms-1"></i>
                } 
              }
            </span>
          </th>
          <th scope="col" style="text-align: center;">
            <span class="header-inline">Acciones </span>
          </th>
        </tr>
      </thead>
      <tbody>
        @for (oComentario of oPage()?.content; track oComentario.id ) {
        <tr>
          <th scope="row">{{ oComentario.id }}</th>
          <td>{{ oComentario.contenido }}</td>
          <td>
            <a [routerLink]="['/usuario/view', oComentario.usuario.id]">
              {{ oComentario.usuario.nombre }} {{ oComentario.usuario.apellido1 }} {{ oComentario.usuario.apellido2 | trim: 20 }}
              {{ ' (' + oComentario.usuario.id + ')' }}
            </a>
            <!-- Botón alineado a la derecha para filtrar usuario -->
            <a
              class="btn btn-warning btn-sm ms-2 float-end"
              [routerLink]="['/comentario/usuario', oComentario.usuario.id]"
              role="button"
              title="Filtrar por usuario"
              ><i class="bi bi-funnel-fill" aria-hidden="true"></i
            ></a>
          </td>
          <td>
            <a [routerLink]="['/noticia/view', oComentario.noticia.id]">
              {{ oComentario.noticia.titulo | trim: 20 }}
              {{ ' (' + oComentario.noticia.id + ')' }}
            </a>
            <!-- Botón alineado a la derecha para filtrar equipo -->
            <a
              class="btn btn-warning btn-sm ms-2 float-end"
              [routerLink]="['/comentario/noticia', oComentario.noticia.id]"
              role="button"
              title="Filtrar por equipo"
              ><i class="bi bi-funnel-fill" aria-hidden="true"></i
            ></a>
          </td>
           <!-- Acciones -->
          <td>
            <div class="d-flex justify-content-center">
              <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                <a
                  class="btn btn-primary btn-sm"
                  [routerLink]="['/comentario/view', oComentario.id]"
                  role="button"
                  title="Ver"
                  ><i class="bi bi-eye" aria-hidden="true"></i
                ></a>
                <a
                  class="btn btn-warning btn-sm"
                  [routerLink]="['/comentario/edit', oComentario.id]"
                  role="button"
                  title="Editar"
                  ><i class="bi bi-pencil" aria-hidden="true"></i
                ></a>
                <a
                  class="btn btn-danger btn-sm"
                  [routerLink]="['/comentario/delete', oComentario.id]"
                  role="button"
                  title="Eliminar"
                  ><i class="bi bi-trash" aria-hidden="true"></i
                ></a>
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  
  @if (totalRecords() === 0) {
  <div class="d-flex justify-content-center my-4">
    <div class="alert alert-secondary text-center w-100" style="max-width: 720px">
      <h5 class="mb-1">No hay jugadores</h5>
      <p class="small mb-2">No hay registros para mostrar en este momento.</p>
    </div>
  </div>
  }
</div>
