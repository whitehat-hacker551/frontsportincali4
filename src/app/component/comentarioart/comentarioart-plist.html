<div class="container my-2">
  <div class="d-flex justify-content-center my-3">
    <h1>Comentarios de Artículos</h1>
  </div>

  @if (message()) {
    <div class="alert alert-success text-center">
      {{ message() }}
    </div>
  }

  <!-- Búsqueda por contenido -->
  <div class="d-flex justify-content-center my-2">
    <input
      class="form-control"
      type="search"
      placeholder="Buscar por contenido"
      (input)="onSearchContenido($event.target.value)"
      [value]="contenido()"
    />
  </div>

  <!-- Total registros -->
  <div class="d-flex justify-content-center my-1">
    <small class="text-muted">Total registros: {{ totalRecords() }}</small>

    @if (contenido().length > 0) {
      <small class="text-muted ms-3">
        Filtro: contenido contiene "{{ contenido() }}"
      </small>
    }
  </div>

  @if (totalRecords() > 0) {
    <div class="d-flex justify-content-between my-2">
      <app-paginacion
        [numPage]="numPage()"
        [numPages]="oPage()?.totalPages || 1"
        (pageChange)="goToPage($event)">
      </app-paginacion>

      <app-botonera-rpp
        [numRpp]="numRpp()"
        (rppChange)="onRppChange($event)">
      </app-botonera-rpp>
    </div>
  }

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th (click)="onOrder('id')" style="cursor:pointer">ID</th>
        <th (click)="onOrder('contenido')" style="cursor:pointer">Contenido</th>
        <th (click)="onOrder('idArticulo')" style="cursor:pointer">Artículo</th>
        <th (click)="onOrder('idUsuario')" style="cursor:pointer">Usuario</th>
        <th>Acciones</th>
      </tr>
    </thead>

    <tbody>
      @for (comentario of oPage()?.content; track comentario.id) {
        <tr>
          <td class="text-center">{{ comentario.id }}</td>
          <td>{{ comentario.contenido }}</td>
          <td class="text-center">
            <a [routerLink]="['/articulo/view', comentario.idArticulo]">
              {{ comentario.articulo?.descripcion || 'Sin artículo' }} ({{ comentario.idArticulo }})
            </a>
          </td>
          <td class="text-center">
            <a [routerLink]="['/usuario/view', comentario.idUsuario]">
              {{ comentario.usuario?.nombre }} {{ comentario.usuario?.apellido1 }} {{ comentario.usuario?.apellido2 }} ({{ comentario.idUsuario }})
            </a>
          </td>
          <td class="text-center">
            <div class="btn-group btn-group-sm">
              <a
                class="btn btn-primary"
                [routerLink]="['/comentarioart/view', comentario.id]"
                title="Ver">
                <i class="bi bi-eye"></i>
              </a>
              <a
                class="btn btn-warning"
                [routerLink]="['/comentarioart/edit', comentario.id]"
                title="Editar">
                <i class="bi bi-pencil"></i>
              </a>
              <a
                class="btn btn-danger"
                [routerLink]="['/comentarioart/delete', comentario.id]"
                title="Eliminar">
                <i class="bi bi-trash"></i>
              </a>
            </div>
          </td>
        </tr>
      }
    </tbody>
  </table>
</div>
