<div class="container my-2">
  <div class="d-flex justify-content-center my-3">
    <h1>Jugadores</h1>
  </div>

  

  <!-- Aviso (mensaje desde queryParams) -->
  @if (message()) {
    <div class="d-flex justify-content-center my-2">
      <div class="alert alert-success w-100 text-center" role="alert">
        {{ message() }}
      </div>
    </div>
  }

  <!-- Búsqueda por posición usando debounce -->
  <div class="d-flex justify-content-center my-2">
    <input
      class="form-control me-2"
      type="search"      
      placeholder="Buscar por posición del jugador"
      aria-label="Search"
      (input)="onSearchPosicion($event.target.value)"
      [value]="posicion()"
      name="searchPosicion"
    />
  </div>

  <!-- Total registros -->
  <div class="d-flex justify-content-center my-1">
    <small class="text-muted">Total registros: {{ totalRecords() || 0 }}</small>
    @if (usuario() > 0) {
      <small class="text-muted ms-3">Filtro: id de usuario = {{ usuario() }}</small>
      <!-- quitar el filtro -->
      <a class="ms-2" [routerLink]="['/jugador']" role="button" title="Quitar filtro"
        ><i class="bi bi-x-lg" aria-hidden="true"></i> Quitar filtro</a
      >
    }
    @if (equipo() > 0) {
      <small class="text-muted ms-3">Filtro: id de equipo = {{ equipo() }}</small>
      <!-- quitar el filtro -->
      <a class="ms-2" [routerLink]="['/jugador']" role="button" title="Quitar filtro"
        ><i class="bi bi-x-lg" aria-hidden="true"></i> Quitar filtro</a
      >
    }
    @if (posicion().length > 0) {
      <small class="text-muted ms-3">Filtro: posición contiene "{{ posicion() }}"</small>
      <!-- quitar el filtro -->
    }
  </div>

  <div class="d-flex justify-content-between my-1" [hidden]="totalRecords() === 0">
    <app-paginacion
      [numPage]="numPage()"
      [numPages]="oPage()?.totalPages || 1"
      (pageChange)="goToPage($event)"
    >
    </app-paginacion>

    <app-botonera-rpp [numRpp]="numRpp()" (rppChange)="onRppChange($event)"> </app-botonera-rpp>
  </div>

  <div class="d-flex justify-content-center" [hidden]="totalRecords() === 0">
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th scope="col" (click)="onOrder('id')" style="cursor: pointer; width: 5%">
            <span class="header-inline"
              >ID @if (orderField() === 'id') { @if (orderDirection() === 'asc') {
              <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
              } @if (orderDirection() === 'desc') {
              <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
              } }
            </span>
          </th>
          <th scope="col" (click)="onOrder('dorsal')" style="cursor: pointer; width: 10%">
            <span class="header-inline"
              >Dorsal @if (orderField() === 'dorsal') { @if (orderDirection() === 'asc') {
              <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
              } @if (orderDirection() === 'desc') {
              <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
              } }
            </span>
          </th>
          <th scope="col" (click)="onOrder('posicion')" style="cursor: pointer; width: 15%">
            <span class="header-inline"
              >Posición @if (orderField() === 'posicion') { @if (orderDirection() === 'asc') {
              <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
              } @if (orderDirection() === 'desc') {
              <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
              } }
            </span>
          </th>
          <th scope="col" style="cursor: pointer; width: 10%">
            <span class="header-inline">Capitán</span>
          </th>
          <th scope="col" style="width: 10%">Imagen</th>
          <th scope="col" (click)="onOrder('usuario')" style="cursor: pointer; width: 25%">
            <span class="header-inline"
              >Jugador @if (orderField() === 'usuario') { @if (orderDirection() === 'asc') {
              <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
              } @if (orderDirection() === 'desc') {
              <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
              } }
            </span>
          </th>
          <th scope="col" (click)="onOrder('equipo')" style="cursor: pointer; width: 20%">
            <span class="header-inline"
              >Equipo @if (orderField() === 'equipo') { @if (orderDirection() === 'asc') {
              <i class="bi bi-caret-up-fill ms-1"></i>
              } @if (orderDirection() === 'desc') {
              <i class="bi bi-caret-down-fill ms-1"></i>
              } }
            </span>
          </th>
          <th scope="col" (click)="onOrder('pagos')" style="cursor: pointer; width: 10%; text-align: center;">
            <span class="header-inline"
              >Pagos @if (orderField() === 'pagos') { @if (orderDirection() === 'asc') {
              <i class="bi bi-caret-up-fill ms-1"></i>
              } @if (orderDirection() === 'desc') {
              <i class="bi bi-caret-down-fill ms-1"></i>
              } }
            </span>
          </th>
          <th scope="col">
            <span class="header-inline">Acciones </span>
          </th>
        </tr>
      </thead>
      <tbody>
        @for (jugador of oPage()?.content; track jugador.id ) {
        <tr>
          <th scope="row">{{ jugador.id }}</th>
          <td>{{ jugador.dorsal }}</td>
          <td>{{ jugador.posicion }}</td>
          <td class="text-center align-middle">
            @if (jugador.capitan) {
            <span class="text-warning d-inline-flex align-items-center">
              <i class="bi bi-star-fill me-1"></i>
            </span>
            } @if (!jugador.capitan) {
            <span class="text-secondary d-inline-flex align-items-center">
              <i class="bi bi-star me-1"></i>
            </span>
            }
          </td>
          <td>
            @if (jugador.imagen) {
            <img 
              [src]="getImagenUrl(jugador.imagen)" 
              alt="Imagen jugador" 
              class="img-thumbnail" 
              style="max-width: 50px;"
              (error)="$any($event.target).src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2250%22 height=%2250%22%3E%3Crect fill=%22%23ddd%22 width=%2250%22 height=%2250%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23999%22 font-size=%2214%22%3E?%3C/text%3E%3C/svg%3E'"
            >
            } @if (!jugador.imagen) {
            <span class="text-muted small">Sin imagen</span>
            }
          </td>
          <td>
            @if (jugador.usuario) {
            <a [routerLink]="['/usuario', '/view', jugador.usuario.id]">
              {{ jugador.usuario.nombre }} {{ jugador.usuario.apellido1 }} {{ jugador.usuario.apellido2 | trim: 20 }}
              {{ ' (' + jugador.usuario.id + ')' }}
            </a>
            <!-- Botón alineado a la derecha para filtrar usuario -->
            <a
              class="btn btn-warning btn-sm ms-2 float-end"
              [routerLink]="['/jugador/usuario', jugador.usuario.id]"
              role="button"
              title="Filtrar por usuario"
              ><i class="bi bi-funnel-fill" aria-hidden="true"></i
            ></a>
            } @if (!jugador.usuario) {
            <span class="text-muted">N/A</span>
            }
          </td>
          <td>
            @if (jugador.equipo) {
            <a [routerLink]="['/equipo', '/view', jugador.equipo.id]">
              {{ (jugador.equipo.nombre || '') | trim: 20 }}
              {{ ' (' + jugador.equipo.id + ')' }}
            </a>
            <!-- Botón alineado a la derecha para filtrar equipo -->
            <a
              class="btn btn-warning btn-sm ms-2 float-end"
              [routerLink]="['/jugador/equipo', jugador.equipo.id]"
              role="button"
              title="Filtrar por equipo"
              ><i class="bi bi-funnel-fill" aria-hidden="true"></i
            ></a>
            } @if (!jugador.equipo) {
            <span class="text-muted">N/A</span>
            }
          </td>
          <td style="text-align: center">
            @if (jugador.pagos === 0) {
              <i class="bi bi-ban" aria-hidden="true"></i> 
            } @else {
              <a [routerLink]="['/pago','jugador', jugador.id]">
                {{ jugador.pagos }}
              </a>
            }
          </td>
           <!-- Acciones -->
          <td>
            <div class="d-flex justify-content-center">
              <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                <a
                  class="btn btn-primary btn-sm"
                  [routerLink]="['/jugador/view', jugador.id]"
                  role="button"
                  title="Ver"
                  ><i class="bi bi-eye" aria-hidden="true"></i
                ></a>
                <a
                  class="btn btn-warning btn-sm"
                  [routerLink]="['/jugador/edit', jugador.id]"
                  role="button"
                  title="Editar"
                  ><i class="bi bi-pencil" aria-hidden="true"></i
                ></a>
                <a
                  class="btn btn-danger btn-sm"
                  [routerLink]="['/jugador/delete', jugador.id]"
                  role="button"
                  title="Eliminar"
                  ><i class="bi bi-trash" aria-hidden="true"></i
                ></a>
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  
  @if (totalRecords() === 0) {
  <div class="d-flex justify-content-center my-4">
    <div class="alert alert-secondary text-center w-100" style="max-width: 720px">
      <h5 class="mb-1">No hay jugadores</h5>
      <p class="small mb-2">No hay registros para mostrar en este momento.</p>
    </div>
  </div>
  }
</div>
