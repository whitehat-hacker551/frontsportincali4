<div class="container my-2">
  <div class="d-flex justify-content-center my-3">
    <h1>Cuotas</h1>
  </div>

  @if (message()) {
  <div class="d-flex justify-content-center my-2">
    <div class="alert alert-success w-100 text-center" role="alert">
      {{ message() }}
    </div>
  </div>
  }

  <!-- Búsqueda por descripción usando debounce -->
  @if (equipo() <= 0) { <div class="d-flex justify-content-center my-2">
    <input class="form-control me-2" type="search" placeholder="Buscar por descripción" aria-label="Search"
      (input)="onSearchDescription($event.target.value)" [value]="descripcion()" name="searchDescription" />
</div>
}

<!-- Total registros -->
<div class="d-flex justify-content-center my-1">
  <small class="text-muted">Total registros: {{ totalRecords() || 0 }}</small>
  @if (equipo() > 0) {
  <small class="text-muted ms-3">Filtro: id de equipo = {{ equipo() }}</small>
  <!-- quitar el filtro -->
  <a class="ms-2" [routerLink]="['/cuota']" role="button" title="Quitar filtro"><i class="bi bi-x-lg"
      aria-hidden="true"></i> Quitar filtro</a>
  }
  @if (descripcion().length > 0) {
  <small class="text-muted ms-3">Filtro: descripción contiene "{{ descripcion() }}"</small>
  <!-- quitar el filtro -->
  }
</div>

@if (totalRecords() > 0) {
<div class="d-flex justify-content-between my-1">
  <app-paginacion [numPage]="numPage()" [numPages]="oPage()?.totalPages || 1" (pageChange)="goToPage($event)">
  </app-paginacion>

  <app-botonera-rpp [numRpp]="numRpp()" (rppChange)="onRppChange($event)"> </app-botonera-rpp>
</div>
}

<div class="d-flex justify-content-center">
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th scope="col" (click)="onOrder('id')" style="cursor: pointer; width: 5%">
          <span class="header-inline">ID
            @if (orderField() === 'id') {
            @if (orderDirection() === 'asc') {
            <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
            }
            @if (orderDirection() === 'desc') {
            <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
            }
            }
          </span>
        </th>
        <th scope="col" (click)="onOrder('descripcion')" style="cursor: pointer; width: 25%">
          <span class="header-inline">Descripción
            @if (orderField() === 'descripcion') {
            @if (orderDirection() === 'asc') {
            <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
            }
            @if (orderDirection() === 'desc') {
            <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
            }
            }
          </span>
        </th>
        <th scope="col" (click)="onOrder('cantidad')" style="cursor: pointer; width: 10%">
          <span class="header-inline">Cantidad
            @if (orderField() === 'cantidad') {
            @if (orderDirection() === 'asc') {
            <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
            }
            @if (orderDirection() === 'desc') {
            <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
            }
            }
          </span>
        </th>
        <th scope="col" (click)="onOrder('fecha')" style="cursor: pointer; width: 15%">
          <span class="header-inline">Fecha
            @if (orderField() === 'fecha') {
            @if (orderDirection() === 'asc') {
            <i class="bi bi-caret-up-fill ms-1"></i>
            }
            @if (orderDirection() === 'desc') {
            <i class="bi bi-caret-down-fill ms-1"></i>
            }
            }
          </span>
        </th>
        <th scope="col" (click)="onOrder('equipo')" style="cursor: pointer; width: 20%">
          <span class="header-inline">Equipo
            @if (orderField() === 'equipo') {
            @if (orderDirection() === 'asc') {
            <i class="bi bi-caret-up-fill ms-1" aria-hidden="true"></i>
            }
            @if (orderDirection() === 'desc') {
            <i class="bi bi-caret-down-fill ms-1" aria-hidden="true"></i>
            }
            }
          </span>
        </th>
        <th scope="col" style="width: 10%">
          <span class="header-inline">Pagos </span>
        </th>
        <th scope="col">
          <span class="header-inline">Acciones </span>
        </th>
      </tr>
    </thead>
    <tbody>
      @for (oCuota of oPage()?.content; track oCuota.id) {
      <tr>
        <th scope="row" style="text-align: center">{{ oCuota.id }}</th>
        <td>{{ oCuota.descripcion }}</td>
        <td style="text-align: right">{{ oCuota.cantidad }} €</td>
        <td>{{ oCuota.fecha | datetime }}</td>
        <td>
          <a [routerLink]="['/equipo', '/view', oCuota.equipo.id]">
            {{ (oCuota.equipo.nombre || '') | trim: 20 }}
            {{ ' (' + oCuota.equipo.id + ')' }}
          </a>
          <!-- Botón alineado a la derecha para filtrar equipo -->
          <a class="btn btn-warning btn-sm ms-2 float-end" [routerLink]="['/cuota/equipo', oCuota.equipo.id]" role="button"
            title="Filtrar por equipo"><i class="bi bi-funnel-fill" aria-hidden="true"></i></a>
        </td>
        <td style="text-align: center">
          @if (oCuota.pagos === 0) {
          <i class="bi bi-ban" aria-hidden="true"></i>
          } @else {
          <a [routerLink]="['/pago/cuota', oCuota.id]">
            {{ oCuota.pagos }}
          </a>
          }
        </td>
        <td>
          <div class="d-flex justify-content-center">
            <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
              <a class="btn btn-primary btn-sm" [routerLink]="['/cuota/view', oCuota.id]" role="button" title="Ver"><i
                  class="bi bi-eye" aria-hidden="true"></i></a>
              <a class="btn btn-warning btn-sm" [routerLink]="['/cuota/edit', oCuota.id]" role="button"
                title="Editar"><i class="bi bi-pencil" aria-hidden="true"></i>
              </a>
              <a class="btn btn-danger btn-sm" [routerLink]="['/cuota/delete', oCuota.id]" role="button"
                title="Eliminar"><i class="bi bi-trash" aria-hidden="true"></i></a>
            </div>
          </div>
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>
</div>