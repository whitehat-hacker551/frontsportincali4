<div class="container my-2">
  <form [formGroup]="cuotaForm" (ngSubmit)="onSubmit()" novalidate>
    <div class="mb-3">
      <label class="form-label">Descripción <span class="text-danger">*</span></label>
      <input class="form-control" formControlName="descripcion" [class.is-invalid]="descripcion?.invalid && descripcion?.touched" />
      @if (descripcion?.invalid && descripcion?.touched) { <div class="invalid-feedback">La descripción es obligatoria (3-255).</div> }
    </div>

    <div class="mb-3">
      <label class="form-label">Cantidad (€) <span class="text-danger">*</span></label>
      <input type="number" class="form-control" formControlName="cantidad" [class.is-invalid]="cantidad?.invalid && cantidad?.touched" />
      @if (cantidad?.invalid && cantidad?.touched) { <div class="invalid-feedback">Introduce una cantidad válida.</div> }
    </div>

    <div class="mb-3">
      <label class="form-label">Fecha <span class="text-danger">*</span></label>
      <input type="date" class="form-control" formControlName="fecha" [class.is-invalid]="fecha?.invalid && fecha?.touched" />
      @if (fecha?.invalid && fecha?.touched) { <div class="invalid-feedback">La fecha es obligatoria.</div> }
    </div>

    <div class="mb-3">
      <label class="form-label">Equipo <span class="text-danger">*</span></label>
      <div class="d-flex gap-2 align-items-end">
        <select class="form-select" formControlName="id_equipo" [class.is-invalid]="id_equipo?.invalid && id_equipo?.touched">
          <option [value]="null" disabled>Seleccione un equipo</option>
          @for (equipo of equipos(); track equipo.id) {
            <option [value]="equipo.id">{{ equipo.nombre }} ({{ equipo.id }})</option>
          }
        </select>
        <button type="button" class="btn btn-info" (click)="openEquipoFinderModal()"><i class="bi bi-search me-1"></i>Buscar</button>
      </div>

      <div class="d-flex gap-3 align-items-end mt-2">
        <div>
          <label class="form-label">ID Equipo</label>
          <input type="text" class="form-control" [value]="displayIdEquipo() || ''" readonly />
        </div>
        @if (selectedEquipo()) {
          <div class="flex-grow-1">
            <label class="form-label">Nombre</label>
            <p class="form-control-plaintext fw-semibold mb-0">{{ selectedEquipo()?.nombre }}</p>
          </div>
        }
      </div>
    </div>

    <div class="d-flex justify-content-between">
      <button type="button" class="btn btn-outline-secondary" (click)="onCancel()">Cancelar</button>
      <button type="submit" class="btn btn-primary" [disabled]="submitting() || cuotaForm.invalid">
        @if (submitting()) { <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span> }
        Guardar
      </button>
    </div>
  </form>
</div>
